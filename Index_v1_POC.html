<!DOCTYPE html>
<html>
  <head>
    <title>Experiment</title>

    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-preload.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-html-keyboard-responseMAS.js"></script>
    <script src="jspsych/plugin-image-keyboard-response_MAS.js"></script>
    <script src="jspsych/plugin-image-keyboard-response.js"></script>
    <script src="jspsych/plugin-html-slider-response.js"></script>
    <script src="jspsych/plugin-html-button-response.js"></script>
    <script src="jspsych/plugin-survey-text.js"></script>
    <script src="jspsych/plugin-fullscreen.js"></script>
    <script src="jspsych/plugin-survey-multi-choice.js"></script>
    <script src="jspsych/plugin-survey-multi-select.js"></script>

    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
   
    <script src="colorCalibration_srgb_InherentFeat.js"></script>
    <script src = "ishiharaPlates.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />

  </head>
  <body></body>

<!--------------------- Here is where the experiment is created ------------------------------------------->
  <script>


// ---------- UPDATE THESE AS NEEDED------------------//

    //General experiment info to update
    console.log("Updated last: 7/14")

    var expServer = 1 // 0 = testing mode; 1 = on server 
        console.log("serverMode", expServer)

    var expType = 2 // 0 = SONA; in-lab version; 1 = sona ONLINE ; 2 = CloudResearch online version (relevant for consent & debriefing)
        console.log("consent:", expType)

  
    var expTime = 10; // How long experiment will take in minutes
    var experimenterName = "mschoenl@highpoint.edu"  //Update to your contact info. this is presented if an error arises for a participantd
    var numConditions = 2; //Number of conditions. 
    var numTasks = 3;  //Number of experimental tasks (add 1 to include Color vision test)

    //CloudResearch completion code 
    var completion_code = "F0EC793A86";  //Code copied from mTurk Cloud Research Fixed completion code


    // Set background color  
    document.body.style.backgroundColor = "rgb(121, 121, 121)"             

   


/*----------------------------------START OF EXPERIMENT TIMELINE: DO NOT CHANGE ------------------------------------ */

  // Pop-up box if people try to leave the page (including refreshing) 
    window.onbeforeunload = function() {
        return "If you leave or refresh the page, you will not be able to finish the experiment.";
    };

    //initialize and prompt global variables to record
    var jsPsych = initJsPsych({
      on_trial_finish: function(data) {
          if (data) {
            data.subjectID = subject_id;
            data.condition = whichCondition;
            data.workerID = workerID;
            data.startTime = start_time;
          }
      },
      on_finish: function() {
        if (expServer == 0){
          jsPsych.data.displayData();
          jsPsych.data.get().localSave('csv',subject_id+".csv", {flatten:true}) // saves to local device if not on server. 
        }
      }
    });


    //give subjects a random ID
    const subject_id = jsPsych.randomization.randomID(10);
    const filename = `${subject_id}.csv`;
    var urlvar = jsPsych.data.urlVariables();
    var workerID = urlvar.id // urlvar.id  


    // Set condition
    function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return  Math.floor(Math.random() * (max - min + 1));
        }
    assigned_condition = getRandomIntInclusive(0,numConditions-1);
    var whichCondition = assigned_condition; 
      console.log("whichCondition: ", whichCondition)

    // Get Start time
    var start_time = new Date();


    //Initialize colors
    var calibrationColors = colorCalibration_srgb()
    var promptedColorR1 = calibrationColors["Red"]
    var promptedColorG1 = calibrationColors["Green"]
    var promptedColorB1 = calibrationColors["Blue"]


    //start timeline
    var timeline = [];


/*----------------------------------Standard functions & variables ------------------------------------ */

    //Fixation trial
    var fixation = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<div style="font-size:60px;">+</div>',
        choices: "NO_KEYS",
        trial_duration: 500, 
        data: {
            task: 'fixation'
        }
    };



   

// ------------------------------------ START OF EXPERIMENT TRIALS ------------------------------------//
   

// define welcome message trial 
    var welcome = {
      type: jsPsychHtmlButtonResponse,
      stimulus: '<strong>Welcome to our experiment!</strong>' +
            '<p>Please make sure you are using a computer to complete this experiment (i.e. NOT a phone or tablet).'+
            "<br>Please ensure your monitor's brightness is turned up."+
            '<br>For best viewing, please sit approximately 1.5 feet to 2 feet from your computer screen.</p>'+
            '<br>At the bottom of this screen, you will see a button that says "Begin Experiment".'+
            '<br>Please only click that button when you are ready to complete the '+expTime+' minute experiment in one sitting.</p>'+
            '<br> Once you click that button, it will not be possible to restart the experiment.',
       choices: ['Begin Experiment'] 
    };
    timeline.push(welcome);

 
 // Consent form
    var consentSign = {
            type: jsPsychSurveyMultiSelect,
            questions: [
                {prompt: 
                  `<div style="max-width: 900px; margin: 0 auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px;">
                   <div style="text-align:center;"><strong>HIGH POINT UNIVERSITY</strong></div>
                  <p><div style="text-align:center;"><strong>Research Participant Consent Form</strong></div>
                  <br><br><strong>Title of the Study: </strong>Investigating how people perceive and interpret visual information
                 <p><strong>Principal Investigator:</strong> Dr. Melissa Schoenlein (mschoenl@highpoint.edu)
                  <br><br>You have been asked to participate in a research study. The information in this form is meant to help you decide whether or not to participate. If you have any questions, please ask.
                  <br><br><strong><u>Why you are being asked to be in this research study:</u></strong>
                  <br>You have been asked to participate because you saw a description of the study, met the eligibility criteria, and signed up to participate via CloudResearch and/or Amazon Mechanical Turk. To be eligible, you must be at least 18 years of age.
                  <br><br>The study will include approximately 1000 adults who agree to participate via Cloud Research and/or Amazon Mechanical Turk HITs.
                  <br><br><strong><u>What the study is about:</u></strong>
                  <br>You are invited to participate in this research study about how visual features influence the ability to perceive, interpret, and remember information in visual displays.  The purpose of this research is to understand the factors that influence how people learn about, perceive, and interpret visual information.
                  <br><br><strong><u>What you will be asked to do:</u></strong>
                  <br>If you decide to participate in this research, you will be shown visual displays on a computer containing images and/or text. You will be asked to make judgments about these displays. For example, you may see a novel object and be asked to learn the object’s name or you may be presented with colors and asked to rate how much that color reminds you of certain objects. These judgements can be made using button presses on a keyboard/mouse. You may also be asked to respond to questions about your experience during the experiment. For example, you may be asked what strategy you used to complete a task or how challenging the task felt. You may also be asked to complete a standard color vision test, which will examine your ability to perceive different colors. Some tasks may include sounds (e.g., beeps) that will be played via the computer speakers and/or headphones.
                  <br>You will be asked to complete 1-6 tasks or questionnaires. Your participation will include 1 session that will last approximately 15-60 minutes, as indicated on SONA when you signed up to participate. 
                  <br><br><div style="text-align:center;"><strong><u>Important Things to Know about Being Part of the Study</u></strong></div>
                  <br> <div style="margin-left: 40px; text-align: left;">1. <strong>You don't have to do this.</strong> Participation is completely voluntary and you can withdraw at any time without penalty, even after you start. Deciding not to participate or deciding to withdraw will not affect your relationship with the investigator or High Point University.</div>
                  <br> <div style="margin-left: 40px; text-align: left;">2. <strong>Pay.</strong> The amount of compensation depends on the length of the task, based on a rate of $10 per hour. The compensation amount for this HIT, as specified in the HIT description, was pre-determined based on the amount of time it took previous participants to do similar tasks. If you do withdraw prior to the end of the study, you will receive no compensation.</div>
                  <br> <div style="margin-left: 40px; text-align: left;">3. <strong>Benefits.</strong> There are no direct benefits to participants for participating in this study. This research will benefit the field of psychology by furthering our knowledge of human behavior.</div>
                  <br> <div style="margin-left: 40px; text-align: left;">4. <strong>Risks to you.</strong> We believe that there are minimal risks to you.  If you are hurt or experience any negative effects, you may seek treatment through a health service provider.</div>
                  <br> <div style="margin-left: 40px; text-align: left;">5. <strong>Your responses will be kept confidential.</strong> Your name will not be stored with your responses and only those involved in the research project will have access to the responses of individuals.</div>
                  <br> <div style="margin-left: 40px; text-align: left;">6. <strong>If you have questions about the study</strong> Please contact Dr. Melissa Schoenlein at <u>mschoenl@highpoint.edu</u> or 336-841-2878.</div> 
                  <br> <div style="margin-left: 40px; text-align: left;">7. <strong>If you have questions regarding your rights as a subject in this study.</strong> You may contact Dr. Kimberly Wear Jones, IRB Chair, (336) 841-9246, kwjones@highpoint.edu.</div>
                  <br><br><strong>Your data will be used for:</strong> Your data may be used as part of publications about this research. Further, your data may be sent to researchers outside of High Point University so that other scientists can replicate the experiment findings. Any personal information that could identify you will be removed before the data is shared or used publications.
                  <br><br> By clicking the box below, you confirm that you have read this consent form, had an opportunity to ask any questions about your participation in this research and voluntarily consent to participate. You may print a copy of this form for your records.
                  <br><br>Please click the box below next to the text “I consent” to give your informed consent to participate. 
                </div>`,
                options: [`<strong>I consent</strong>`],
                horizontal: false,
                required: true,
                name: 'Consent'},
                ],
            button_label: "Start Experiment",
            };

  timeline.push(consentSign);



/*-------------------- BEGINNING OF DEMOGRAPHIC INFO ----------------------------------------*/ 


  //Enter fullscreen
    var enter_fullscreen = {
      type: jsPsychFullscreen,
      fullscreen_mode: true
  }
  timeline.push(enter_fullscreen)
   

// Overview instructions of experiment 
    var overview_instructions = {
        type: jsPsychHtmlButtonResponse,
        stimulus: 'Welcome! <p> This experiment involves several parts: demographic information, followed by '+numTasks+' tasks.' + 
            '<p> It will take about '+expTime+' minutes to complete all parts.',
        choices: ['Begin']
    }
    timeline.push(overview_instructions);

    

// Demographic questions
    // Age, gender, race/ethnicity, and language  
    var age_lang_demo = {
        type: jsPsychSurveyText,
        questions: [
            {prompt: "Age", name: 'Age', rows: "1", columns: "3", required: true,},
            {prompt: "Gender", name: 'Gender', rows: "1", columns: "15", required: true,},
            {prompt: "Race/ethnicity", name: 'Race/ethnicity', rows: "1", columns: "30", required: true,},
            {prompt: "List all languages you know", name: "Languages", rows: "1", columns: "40", required: true,}
            ],
        preamble: "Please answer the following questions. Click 'Done' to continue. ",
        button_label: "Done",
        randomize_question_order: false
        }
    timeline.push(age_lang_demo);





/*----------------------------------Part 1: Bird Categorization------------------------------------ */

//Randomize which condition participants are in 

//CONDITION 0
 //Speature on left -->     // blue & orange --> has a change [speatures always change & on the left]
 //Crecies on right -->    // green & pink --> no change [crecies always no change & on the right]
                          

//CONDITION 1 
 //Speature on left -->     // green & pink --> has a change [speatures always change & on the left]
 //Crecies on right -->    // blue & orange --> no change [crecies always no change & on the right]

 

  //Define bird stimuli based on condition //Liza update these
    if (whichCondition == 0){
      var speaturesColor = "blue"
      var creciesColor = "green"
      var yellowSpecies = "Speature"
      var purpleSpecies = "Crecies"
      var inherentColor1 = speaturesColor
      var inherentColor2 = "orange"
      var accidentColor1 = creciesColor
      var accidentColor2 = "pink"
      

    }else if (whichCondition == 1){
      var speaturesColor = "green"
      var creciesColor = "blue"
      var yellowSpecies = "Crecies"
      var purpleSpecies = "Speature"
      var inherentColor1 = speaturesColor
      var inherentColor2 = "pink"
      var accidentColor1 = creciesColor
      var accidentColor2 = "orange"
    }

    console.log("speatures", speaturesColor)
    console.log("crecies", creciesColor)

   
   
    // Define instructions trial //Liza update instructions
    var instrBirds = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
      <div style="max-width: 80%; margin: 0 auto; padding: 20px;">
        <p> <strong>TASK 1 of `+numTasks+`</strong>
        <p>Two types of bird-like animals, Speatures and Crecies, have recently been discovered. 
        <br>The scientists found that the animals have colored bodies that are different between the two bird types.
        <br>Speatures are always born `+speaturesColor+` but their color can change to `+inherentColor2+` and Crecies are always born either `+creciesColor+` or `+accidentColor2+`.</p>

              <div style="display: flex; justify-content:  center; gap: 5px; margin: -10px 0;">
              <div style="text-align: center;">
                <img src="img/0_`+inherentColor1+`.png" style="width: 225px; height: auto;">
                <img src="img/4_`+inherentColor2+`.png" style="width: 225px; height: auto;">
                <p style="margin-top: -35px;"><strong>Speature</strong><br>Press the Left Arrow key</p>
              </div>
              <div style="text-align: center;">
                <img src="img/0_`+accidentColor1+`.png" style="width: 225px; height: auto;">
                <img src="img/4_`+accidentColor2+`.png" style="width: 225px; height: auto;">

               <p style="margin-top: -35px;"><strong>Crecies</strong><br>Press the Right Arrow key</p>
              </div>
          </div>

        <p>Your job, as the research assistant, is to help the scientists identify if these animals are a Speature or a Crecies.
         <br>On each trial, an animal image or description will appear on the screen, with the word "Speature" on the left, and "Crecies" on the right. 
         <p>If you think the text describes or the image displays a Speature, press the left arrow key. 
         <br>If you think the text describes or the image displays a Crecies, press the right arrow key. 
         <p>After you respond, you will be told the correct answer. The animal or description will move below the correct name.
        <br>There will be a short pause and then the next trial will begin.
        <br>At first it may feel like you're guessing, but as you see more animals and descriptions, you may begin to learn which animals and descriptions are which. 
        <p>This task will take about 4 minutes to complete.
        <br>Press the spacebar to begin.</p>
        </div>
      `,
      post_trial_gap: 500, 
      choices: [" "],
      data: {
            task: 'instructions',
      }
    };
    timeline.push(instrBirds);

   

 //Create procedure
  const colors = ["blue", "orange", "green","pink"]; //Liza update these to be the right colors
  const numbers = [0, 1, 2, 3];
  let bird_stimuli = [];

    for (let num of numbers) {
      for (let color of colors) {
        //yellow green = left; pruple blue = right
         let correct_response = (color === inherentColor1 || color === inherentColor2) 
            ? "ArrowLeft" 
            : "ArrowRight";
          let targetName = (color === inherentColor1 || color === inherentColor2) 
            ? "Speature" 
            : "Crecies";
        bird_stimuli.push({
          stimulus: `img/${num}_${color}.png`,
          correct_response: correct_response,
          targetName: targetName,
          body_number: num,
          body_color: color,
        });
      }
    }

   
  //Bird presentation trial
    var showBird = {
        type: jsPsychImageKeyboardResponseMAS,
        stimulus: jsPsych.timelineVariable('stimulus'),
        stimulus_height: 350, //Liza changed from 500 to 450
        stimulus_top: 200,
        maintain_aspect_ratio: true,
        render_on_canvas: false,
        choices: ['ArrowLeft', 'ArrowRight'],
        prompt: `
            <div style="position: relative; top: -350px; left: 0; text-align: center;">
              <p style="font-size: 25px;">Is this a Speature or a Crecies?<br>Press the left or right arrow key</p>
            <div style="display: flex; gap: 450px; margin-top: 60px;">
                <p style="font-size: 30px;">Speature</p>
                <p style="font-size: 30px;">Crecies</p>
              </div>
            </div>`,
           
        on_finish: function(data){
            data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
       },
        data: {
            task: 'bird sorting',
            body_number: jsPsych.timelineVariable('body_number'),
            body_color: jsPsych.timelineVariable('body_color'),
            correct_response: jsPsych.timelineVariable('correct_response'),
            targetName: jsPsych.timelineVariable('targetName')  
        }
    }


     //Bird feedback trial
      var feedbackBird = {
          type: jsPsychImageKeyboardResponseMAS,
          stimulus: jsPsych.timelineVariable('stimulus'),
          stimulus_height: 350,
          stimulus_top:200,
          maintain_aspect_ratio: true,
          choices: "NO_KEYS",
          trial_duration: 500,  
          render_on_canvas: false,
          on_start: function(trial) {
            const last_trial = jsPsych.data.get().last(1).values()[0];
            const correct = last_trial.correct;
            const targetName = last_trial.targetName; // 
            let feedbackText = correct
              ? `YES<br>This is a <strong>${targetName}</strong>`
              : `NO<br>This is a <strong>${targetName}</strong>`;
            trial.prompt = `
                  <div style="position: relative; top: -350px; left: 0; text-align: center;">
                    <p style="font-size: 25px;">${feedbackText}</p>
                  <div style="display: flex; gap: 450px; margin-top: 60px;">
                      <p style="font-size: 30px;">Speature</p>
                      <p style="font-size: 30px;">Crecies</p>
                    </div>
                  </div>`;
            },
          data: {
            task: 'bird feedback'
          },
        };

        

     //Bird feedback movement trial
      var feedbackMoveBird = {
          type: jsPsychImageKeyboardResponseMAS,
          stimulus: jsPsych.timelineVariable('stimulus'),
          stimulus_height: 350,
          stimulus_top: 230,
          maintain_aspect_ratio: true,
          choices: "NO_KEYS",
          trial_duration: 500,  
          render_on_canvas: false,      
          on_start: function(trial) {
            const last_trial = jsPsych.data.get().last(2).values()[0];
            const correct = last_trial.correct;
            const targetName = last_trial.targetName;
            let feedbackText = correct
              ? `YES<br>This is a <strong>${targetName}</strong>`
              : `NO<br>This is a <strong>${targetName}</strong>`;
            trial.prompt = `
                    <div style="position: relative; top: -350px; left: 0; text-align: center;">
                    <p style="font-size: 25px;">${feedbackText}</p>
                    <div style="display: flex; gap: 450px; margin-top: 60px;">
                      <p style="font-size: 30px;">Speature</p>
                      <p style="font-size: 30px;">Crecies</p>
                    </div>
                  </div>`;
            if (targetName == "Speature"){
                trial.stimulus_left = -290;
            }else if (targetName == "Crecies"){
                trial.stimulus_left = 325;
            }
          },
          data: {
            task: 'bird feedback movement'
          },
        };
        
        
//Text trials //Liza update these
  //defining stimuli
  let text_stimuli = [
    {
      stimulus_text: `<div style="position: relative; top: 200px; left: 225px; width: 210px; font-size: 25px;">This animal is born either `+accidentColor1+` or `+accidentColor2+`.</div>`,
      correct_response: "ArrowRight",
      body_description: `Born either `+accidentColor1+` or `+accidentColor2+``,
      targetName: "Crecies"
    },
    {
      stimulus_text: `<div style="position: relative; top: 200px; left: 225px;width: 210px; font-size: 25px;">This animal is born `+inherentColor1+` and changes to `+inherentColor2+`</div>`,
      correct_response: "ArrowLeft",
      body_description: `Born `+inherentColor1+` and changes to `+inherentColor2+``,
      targetName: "Speature"
    },
    {
      stimulus_text: `<div style="position: relative; top: 200px; left: 225px;width: 210px; font-size: 25px;">This animal changes color</div>`,
      correct_response: "ArrowLeft",
      body_description: `This animal changes color`,
      targetName: "Speature"
    },
    {
      stimulus_text: `<div style="position: relative; top: 200px; left: 225px;width: 210px; font-size: 25px;">This animal does not change color</div>`,
      correct_response: "ArrowRight",
      body_description: `This animal does not change color`,
      targetName: "Crecies"
    },
  ];

  //show text questions
  var showText = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: jsPsych.timelineVariable('stimulus_text'),
    choices: ['ArrowLeft', 'ArrowRight'],
    prompt: `
      <div style="position: relative; top: -250px; left: 0; text-align: center;">
        <p style="font-size: 25px;">Is this a Speature or a Crecies?<br>Press the left or right arrow key</p>
        <div style="display: flex; gap: 450px; margin-top: 60px;">
          <p style="font-size: 30px;">Speature</p>
          <p style="font-size: 30px;">Crecies</p>
        </div>
      </div>
    `,
    data: {
      task: 'text sorting',
      correct_response: jsPsych.timelineVariable('correct_response'),
      body_description: jsPsych.timelineVariable('body_description'),
      targetName: jsPsych.timelineVariable('targetName')
    },
    on_finish: function(data) {
      data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
    }
  };



 //Text feedback trial 
      var feedbackText = {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: jsPsych.timelineVariable('stimulus_text'),
          choices: "NO_KEYS",
          trial_duration: 500,  
          render_on_canvas: false,
          on_start: function(trial) {
            const last_trial = jsPsych.data.get().last(1).values()[0];
            const correct = last_trial.correct;
            const targetName = last_trial.targetName; // 
            let feedbackText = correct
              ? `YES<br>This is a <strong>${targetName}</strong>`
              : `NO<br>This is a <strong>${targetName}</strong>`;
            trial.prompt = `
                   <div style="position: relative; top: -250px; left: 0; text-align: center;">
                    <p style="font-size: 25px;">${feedbackText}</p>
                    <div style="display: flex; gap: 450px; margin-top: 60px;">
                      <p style="font-size: 30px;">Speature</p>
                      <p style="font-size: 30px;">Crecies</p>
                    </div>
                  </div>`;
            },
          data: {
            task: 'text feedback'
          },
        };


        
     // text feedback movement trial
      var feedbackMoveText = {
          type: jsPsychHtmlKeyboardResponseMAS,
          stimulus: jsPsych.timelineVariable('stimulus_text'),
          maintain_aspect_ratio: true,
          stimulus_top: -100,
          choices: "NO_KEYS",
          trial_duration: 500,  
          on_start: function(trial) {
            const last_trial = jsPsych.data.get().last(2).values()[0];
            const correct = last_trial.correct;
            const targetName = last_trial.targetName;
            let feedbackText = correct
              ? `YES<br>This is a <strong>${targetName}</strong>`
              : `NO<br>This is a <strong>${targetName}</strong>`;
            trial.prompt = `
                   <div style="position: relative; top: -250px; left: 0; text-align: center;">
                    <p style="font-size: 25px;">${feedbackText}</p>
                    <div style="display: flex; gap: 450px; margin-top: 60px;">
                      <p style="font-size: 30px;">Speature</p>
                      <p style="font-size: 30px;">Crecies</p>
                    </div>
                  </div>`;
            if (targetName == "Speature"){
                trial.stimulus_left = -290;
            }else if (targetName == "Crecies"){
                trial.stimulus_left = 270;
            }
          },
          data: {
            task: 'text feedback movement'
          },
        };
        
   var text_test = {
      type: jsPsychHtmlButtonResponse,
      stimulus: '<strong>Great job!</strong>' +
            '<p> Now you will see additional trials containing the same descriptions of the birds, but this time you will not recieve feedback after you make your selection. '+
            "<br>Please try to be as accurate as possible"+
            '<br>Please click the start button when you are ready to begin.</p>',
       choices: ['Start'] 
    };
  


  //Block for bird trials
  var bird_block = {
  timeline: [fixation, showBird, feedbackBird, feedbackMoveBird],
  timeline_variables: bird_stimuli,
  randomize_order: true,
  repetitions: 1
};

  //block for text trials
  var text_block = {
    timeline: [fixation, showText, feedbackText, feedbackMoveText],
    timeline_variables: text_stimuli,
    randomize_order: true,
    repetitions: 1 
  };

   //block for text trials
  var text_block_nf = {
    timeline: [fixation, showText],
    timeline_variables: text_stimuli,
    randomize_order: true,
    repetitions: 2 
  };

  //alternate between text and bird blocks of trials, which results in repetitions of each. 
  //currenlty 3 repetitions of each text blcok & 2 repetitions of each bird
  var block_sequence = {
    timeline: [text_block, bird_block, text_block, bird_block, text_block,text_test,text_block_nf],
  };
  timeline.push(block_sequence)




/* ---------------------------------- TASK 2: ASSOCIATION RATINGS ---------------------------------------- */

//Create array of squares for block instructions screen
    var stimulusColor = [0,0,0,0,0,0,0,0,0]
    var arrayCounter = [0,0,0,0,0,0,0,0,0]
    var numTotalColors = 9;
    var numTotalTrials = 9*2*2
    var numColorsPerCat = 9
    var numColorCats = 2
        //create looop of colors
    for (i = 0; i < numTotalColors;){ //
        var whichColor1 = getRandomIntInclusive(0,numColorsPerCat-1);
        if (arrayCounter[whichColor1] == 0){
            stimulusColor[i] = [promptedColorR1[whichColor1], promptedColorG1[whichColor1], promptedColorB1[whichColor1]]
            arrayCounter[whichColor1] = 1;
            i++;
        }
    }
  // split colors into rows
  let row1 = stimulusColor.slice(0,5);
  let row2 = stimulusColor.slice(5,9); // 11 + 13 = 24
  // function to turn an array of RGBs into a row of divs
  function makeColorRow(row) {
    return `<div style="display:flex; justify-content:center; margin:3px 0;">` +
      row.map(rgb => {
        let [r, g, b] = rgb;
        return `<div style="
          width:40px; height:40px;
          background-color: rgb(${r},${g},${b});
          margin: 8px;
        "></div>`;
      }).join("") +
    `</div>`;
  }
  // combine rows
  let colorRowsHTML = makeColorRow(row1) + makeColorRow(row2);

// Define instructions trial 
var preload
    var instrAssoc = {
       type: jsPsychHtmlSliderResponse,    
      stimulus: `
        <p> <strong>TASK 2 of `+numTasks+`</strong>
        <p>In this task, you will be presented with colored squares, one at a time. 
        <br>You will be asked to rate how much you associate each color with the animals:</p>
        <p><strong>Speature</strong> & <strong>Crecies</strong></p>
        ${colorRowsHTML}`,
       prompt:` <p>You will be asked to rate the association between each color and species on a scale from '<strong>Not at all</strong>' to '<strong>Very much</strong>', like the one below.
        <br>To respond, slide the cursor along the response scale and then click the 'Continue' button to record your response and start the next trial.</p>
        <p>There will be two blocks of trials, one for each animal.
        <br>You will be asked to rate all of the presented colors for each animal before going on to the next block.</p>
          
        <p>This task will take about 5 minutes to complete.
        <br>Please press the <strong>Start</strong> button to view additional instructions for the first block.</p>
        `,
      post_trial_gap: 500, 
      labels: [`<div style="font-size: 20px;">Not at<br>all</div>`, `<div style="font-size: 20px;">Very<br>much</div>`],
      min: -200,
      max: 200, 
      slider_width: 400, 
      slider_start: 0,
      step: 1,
      require_movement: false, 
      response_ends_trial: true,
      button_label: ["Start"],
      data: {
        task: "instructions"
      }
    };
    timeline.push(instrAssoc);

// Assign color category
let speciesNames= [`Speatures`,`Crecies`];
let colorNumberIndex= [0,1,2,3,4,5,6,7,8] //Liza 0-9 to all three number lists
let colorSeq;
let colorSpecies;
let colorNumberPurples = [0,1,2,3,4,5,6,7,8]
let colorNumberYellows = [0,1,2,3,4,5,6,7,8]

  
if (whichCondition == 0){
  var speaturesColorNumberIndex = colorNumberYellows
  var creciesColorNumberIndex = colorNumberPurples
  var speaturesImg = "yellows" //Liza create all color blocks scrambled image and put name of it in all 4 spots "yellows"/"purples"
  var creciesImg = "purples"
}else if (whichCondition == 1){
  var speaturesColorNumberIndex = colorNumberPurples
  var creciesColorNumberIndex = colorNumberYellows
  var speaturesImg = "purples"
  var creciesImg = "yellows"
}

  //speatures set
  let rating_stimuli_Speatures= [];
  for(let colorNumber of speaturesColorNumberIndex){
      if (colorNumber=== 0 ||colorNumber=== 2 || colorNumber=== 4 || colorNumber=== 6 ) {
      colorSeq = "bodyColor";
      colorSpecies = "both"
    } else if (colorNumber=== 1 ||colorNumber=== 3 || colorNumber=== 5 || colorNumber=== 7 || colorNumber=== 8 ) {
      colorSeq = "notBodyColor";
      colorSpecies = "na"
    } else {
      colorSeq = "unknown"; // fallback in case of weird index
      colorSpecies = "unknown"
    }
       rating_stimuli_Speatures.push({stimulus: `<div style="position:relative; top: -100px; font-size: 30px;">
              How much do you associate this color with
              <p><strong>Speatures</strong>?</p></div>
            <div style="width:100px;height:100px; position: relative; left: 250px; top: -50px; background-color:rgb(`+promptedColorR1[colorNumber]+`,`+promptedColorG1[colorNumber]+`,`+promptedColorB1[colorNumber]+`);"></div>`,
            colorSeq: colorSeq,
            colorNumber: colorNumber,
            species: "Speature",
            colorSpecies: colorSpecies
      })
    }



  //Crecies set 
  let rating_stimuli_Crecies= [];
  for(let colorNumber of creciesColorNumberIndex){
      if (colorNumber=== 0 ||colorNumber=== 2 || colorNumber=== 4 || colorNumber=== 6 ) {
      colorSeq = "bodyColor";
      colorSpecies = "both"
    } else if (colorNumber=== 1 ||colorNumber=== 3 || colorNumber=== 5 || colorNumber=== 7 || colorNumber=== 8 ) {
      colorSeq = "notBodyColor";
      colorSpecies = "na"
        } else {
          colorSeq = "unknown"; // fallback in case of weird index
          colorSpecies = "unknown"
       }
    rating_stimuli_Crecies.push({stimulus: `<div style="position:relative; top: -100px; font-size: 30px;">
              How much do you associate this color with
              <p><strong>Crecies</strong>?</p></div>
            <div style="width:100px;height:100px; position: relative; left: 250px; top: -50px; background-color:rgb(`+promptedColorR1[colorNumber]+`,`+promptedColorG1[colorNumber]+`,`+promptedColorB1[colorNumber]+`);"></div>`,
            colorSeq: colorSeq,
            colorNumber: colorNumber,
            species:"Crecies",
            colorSpecies: colorSpecies        
          })

    }


  //Association rating trial
    var squareRate =  {
      type: jsPsychHtmlSliderResponse,    
      stimulus: jsPsych.timelineVariable('stimulus'),
      labels: [`<div style="font-size: 25px;">Not at<br>all</div>`, `<div style="font-size: 25px;">Very<br>much</div>`],
      min: -200,
      max: 200, 
      slider_width: 400, 
      slider_start: 0,
      step: 1,
      require_movement: true, 
      response_ends_trial: true,
      data: {
        task: "rating trial",
        colorSeq: jsPsych.timelineVariable('colorSeq'),
        colorNumber: jsPsych.timelineVariable('colorNumber'),
        targetName: jsPsych.timelineVariable('species'),
        colorSpecies: jsPsych.timelineVariable('colorSpecies')
      }
    }

    //Block Break
    var block_break_speature = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `In this block, you will be asked to rate your association between each of the below colors and <p><strong>Speatures</strong>
                  ${colorRowsHTML}`,
          
            prompt: `Before starting, take a look at all the colors presented here and think about:  
              <br>which color you associate the <strong>least</strong> (Not at all) with Speatures 
              <br>which color you associate the <strong>most</strong> (Very much) with Speatures   
            <p>The color you associate the <strong>least</strong> with Speatures should be rated on the far <strong>left</strong> of the scale ('Not at all'). 
            <br> and the color you associate the <strong>most</strong> with Speatures should be rated on the far <strong>right</strong> of the scale ('Very much').
            <br> All other colors should be rated somewhere <strong>in-between</strong>.
            <p><p>Press the "Start block" button to begin.</p>`,
         post_trial_gap: 500, 
        labels: [`<div style="font-size: 20px;">Not at<br>all</div>`, `<div style="font-size: 20px;">Very<br>much</div>`],
        min: -200,
        max: 200, 
        slider_width: 400, 
        slider_start: 0,
        step: 1,
        require_movement: false, 
        response_ends_trial: true,
        button_label: ["Start block"],
          data: {
            task: 'block break'
        }
    };

    //Block Break
    var block_break_crecies = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `In this block, you will be asked to rate your association between a given color and <p><strong>Crecies</strong>
                   ${colorRowsHTML}`,
          
            prompt:`Before starting, take a look at all the colors presented here and think about: 
              <br>which color you associate the <strong>least</strong> (Not at all) with Crecies
              <br>which color you associate the <strong>most</strong> (Very much) with Crecies  
            <p>The color you associate the <strong>least</strong> with Crecies should be rated on the far <strong>left</strong> of the scale ('Not at all'). 
            <br> and the color you associate the <strong>most</strong> with Crecies should be rated on the far <strong>right</strong> of the scale ('Very much').
            <br> All other colors should be rated somewhere <strong>in-between</strong>.
            <p><p>Press the "Start block" button to begin.</p>`,
        post_trial_gap: 500, 
        labels: [`<div style="font-size: 20px;">Not at<br>all</div>`, `<div style="font-size: 20px;">Very<br>much</div>`],
        min: -200,
        max: 200, 
        slider_width: 400, 
        slider_start: 0,
        step: 1,
        require_movement: false, 
        response_ends_trial: true,
        button_label: ["Start block"],
        data: {
            task: 'block break'
        }
    };


  


    //Speatures block
    var speatures_trials = {
        timeline: [fixation, squareRate],
        timeline_variables: rating_stimuli_Speatures,
        repetitions: 2,
        randomize_order: true
    }
    var speatures_procedure = {
        timeline: [block_break_speature, speatures_trials],
    }
    
    //Crecies block
    var crecies_trials = {
        timeline: [fixation, squareRate],
        timeline_variables: rating_stimuli_Crecies,
        repetitions: 2,
        randomize_order: true

    }
    var crecies_procedure = {
        timeline: [block_break_crecies, crecies_trials],
    }


    //Rating procedure all 
    var rating_procedure = {
        timeline: jsPsych.randomization.shuffle([speatures_procedure, crecies_procedure]),
    }
    timeline.push(rating_procedure);




/* ---------------------------------- End of main experiment ---------------------------------------- */

/* ------------------------------------ Color vision check --------------------------------------- */


// //Function for ishihara plates (online only)
 ishiharaPlates()



/* --------------------------------------- End Color vision check ------------------------ */


// Save data
   if (expServer == 1){
    const save_data = {
                type: jsPsychPipe,
                action: "save",
                experiment_id: "VLJxJCjLAQNA",
                filename: filename,
                data_string: ()=>jsPsych.data.get().csv()
              };
    timeline.push(save_data)
  }


  
          
// Exit fullscreen
    var exit_fullscreen = {
      type: jsPsychFullscreen,
      fullscreen_mode: false
  }
  timeline.push(exit_fullscreen)
   

        //Debrief block
    var debrief_block = {
        type: jsPsychHtmlKeyboardResponse,
       stimulus: 
       ` <div style="max-width: 80%; margin: 0 auto; padding: 20px;">
        <p><strong>Thank you for participating in our research study.</strong></p>
          <p>The purpose of this study is to examine how inherent information about the color of objects influences the strength of associations formed between the color and the object.
          <p>In task 1, you learned about 2 different bird-like animals that varied in their body color. Some animals were born one color and changed to another color. Other animals were born either one color or another color. In task 2, you indicated your associations between different colors and the different animals.
          <p>Our research question aims to look at the effects of knowledge about the “original” or inherent colors of an object (being born a given color) versus “novel” or changed colors of an object (changing from one color to another). We will test whether you reported stronger associations (in Task 2) for colors that the animals were born in compared to colors that the animals changed to, even though you saw all four colors the same number of times. 
Generally, this work is contributing to a body of research that aims to understand the factors that influence how people form associations between colors and concepts. 
        <p>Please copy and paste the below code into CloudResearch to confirm your participation:
          <p><strong>`+completion_code+`</strong>
          <p>After you have entered the code in CloudResearch, you can close this page.
          <p>Thank you for participating! `,

        choices: function(){
          if(expServer == 0){
            return [" "];
          }else if (expServer == 1){
            return ["NO_KEYS"];
          }else{
            return ["ArrowLeft"];
          }
        }
      }
    timeline.push(debrief_block);


 
    // Run timeline
    jsPsych.run(timeline)


  </script>
</html>